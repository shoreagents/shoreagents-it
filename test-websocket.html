<!DOCTYPE html>
<html>
<head>
    <title>WebSocket BPOC Test</title>
</head>
<body>
    <h1>WebSocket BPOC Notification Test</h1>
    <div id="status">Connecting...</div>
    <div id="messages"></div>
    
    <script>
        const statusDiv = document.getElementById('status');
        const messagesDiv = document.getElementById('messages');
        
        // Connect to WebSocket
        const ws = new WebSocket('ws://localhost:3001/ws');
        
        ws.onopen = function() {
            statusDiv.textContent = 'Connected to WebSocket';
            statusDiv.style.color = 'green';
            addMessage('‚úÖ WebSocket connected');
        };
        
        ws.onmessage = function(event) {
            try {
                const message = JSON.parse(event.data);
                addMessage('üì® Received: ' + JSON.stringify(message, null, 2));
                
                // Check if it's a BPOC notification
                if (message.type === 'bpoc_job_status_update') {
                    addMessage('üéØ BPOC NOTIFICATION RECEIVED! Job ID: ' + message.job_id + ', Status: ' + message.new_status);
                }
            } catch (error) {
                addMessage('‚ùå Error parsing message: ' + error.message);
            }
        };
        
        ws.onclose = function() {
            statusDiv.textContent = 'Disconnected from WebSocket';
            statusDiv.style.color = 'red';
            addMessage('‚ùå WebSocket disconnected');
        };
        
        ws.onerror = function(error) {
            statusDiv.textContent = 'WebSocket Error';
            statusDiv.style.color = 'red';
            addMessage('‚ùå WebSocket error: ' + error);
        };
        
        function addMessage(text) {
            const div = document.createElement('div');
            div.textContent = new Date().toLocaleTimeString() + ': ' + text;
            div.style.margin = '5px 0';
            div.style.padding = '5px';
            div.style.border = '1px solid #ccc';
            div.style.borderRadius = '3px';
            messagesDiv.appendChild(div);
        }
        
        // Add instructions
        addMessage('üìã Instructions:');
        addMessage('1. Keep this page open');
        addMessage('2. Run the test script: node scripts/test-bpoc-notifications-fixed.js');
        addMessage('3. Watch for BPOC notifications here');
    </script>
</body>
</html>
